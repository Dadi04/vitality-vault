{% extends 'supplement_store/layout.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}
    Vitality Vault
{% endblock %}

{% block body %}
    <div id="slide-show">
        <div id="image-slider">
            {% for image in images %}
                <div class="slides" style="z-index: {{image.order}};">
                    <img src="{% static '/supplement_store/images/slide_show_images/' %}{{image.image.name|filename}}" class="slide-show-images" data-id="{{image.id}}" id="image-{{image.title}}" alt="{{image.title}}">
                </div>
            {% endfor %}
        </div>
        <img src="{% static '/supplement_store/images/left-arrow.svg' %}" alt="left-arrow" width="50px" id="left-arrow">
        <img src="{% static '/supplement_store/images/right-arrow.svg' %}" alt="right-arrow" width="50px" id="right-arrow">
        <div id="under-slide-show">
            <ul>
                {% for image in images %}
                    <li class="dot" data-id="{{image.id}}"><i class="fa fa-circle"></i></li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% if new_items %}
        <div class="index-section">
            <img src="{% static '/supplement_store/images/left.svg' %}" alt="left1" width="50px" class="left-arrow" id="left-arrow-new">
            <div class="index-items-main">
                <h1>New on Vitality Vault</h1>
                <div class="index-items" id="new-items">
                    {% for item in new_items %}
                        <div class="index-item new-item">
                            <a href="{% url 'shop_by_itemname' itemname=item.fullname %}?flavor={{ item.flavor|urlencode }}"><img src="{% static '/supplement_store/images/product_images/' %}{{item.fullname}}/{{item.main_image.name|filename}}" alt="{{ item.main_image.name|filename }}" height="200px"></a>
                            <h5><a href="{% url 'shop_by_itemname' itemname=item.fullname %}?flavor={{ item.flavor|urlencode }}">{{ item.name }} {{ item.weight }}g</a></h5>
                            <p><a href="{% url 'shop_by_itemname' itemname=item.fullname %}?flavor={{ item.flavor|urlencode }}">Flavor: {{ item.flavor }}</a></p>
                        </div>
                    {% endfor %}
                </div>
            </div>
            <img src="{% static '/supplement_store/images/right.svg' %}" alt="right1" width="50px" class="right-arrow" id="right-arrow-new">
        </div>
    {% endif %}
    {% if items_on_sale %}
        <div class="index-section">
            <img src="{% static '/supplement_store/images/left.svg' %}" alt="left1" width="50px" class="left-arrow" id="left-arrow-sale">
            <div class="index-items-main">
                <h1>Supplements on Sale</h1>
                <div class="index-items" id="sale-items">
                    {% for item in items_on_sale %}
                        <div class="index-item sale-item">
                            <a href="{% url 'shop_by_itemname' itemname=item.fullname %}?flavor={{ item.flavor|urlencode }}"><img src="{% static '/supplement_store/images/product_images/' %}{{item.fullname}}/{{item.main_image.name|filename}}" alt="{{ item.main_image.name|filename }}" height="200px"></a>
                            <h5><a href="{% url 'shop_by_itemname' itemname=item.fullname %}?flavor={{ item.flavor|urlencode }}">{{ item.name }} {{ item.weight }}g</a></h5>
                            <p><a href="{% url 'shop_by_itemname' itemname=item.fullname %}?flavor={{ item.flavor|urlencode }}">Flavor: {{ item.flavor }}</a></p>
                        </div>
                    {% endfor %}
                </div>
            </div>
            <img src="{% static '/supplement_store/images/right.svg' %}" alt="right1" width="50px" class="right-arrow" id="right-arrow-sale">
        </div>
        <hr>
    {% endif %}
    <div id="shop-all-supplements">
        <h1>Vitality Vault is Built for The Strongest</h1>
        <p>You don't want to be ordinary. That's why you're here.</p>
        <p>We believe in the dreamers,</p>
        <p>But more importantly, the doers. We'll provide the tools, you put in the work.</p>
        <p>Together, we can create healthier and longer lives.</p>
        <a href="{% url 'supplements' %}" id="shop-all-supplements-button">SHOP ALL SUPPLEMENTS</a>
    </div>
    {% if popular_items %}
        <hr>
        <div class="index-section">
            <img src="{% static '/supplement_store/images/left.svg' %}" alt="left1" width="50px" class="left-arrow" id="left-arrow-popular">
            <div class="index-items-main">
                <h1>Trending Supplements</h1>
                <div class="index-items" id="popular-items">
                    {% for item in popular_items %}
                        <div class="index-item popular-item">
                            <a href="{% url 'shop_by_itemname' itemname=item.fullname %}?flavor={{ item.flavor|urlencode }}"><img src="{% static '/supplement_store/images/product_images/' %}{{item.fullname}}/{{item.main_image.name|filename}}" alt="{{ item.main_image.name|filename }}" height="200px"></a>
                            <h5><a href="{% url 'shop_by_itemname' itemname=item.fullname %}?flavor={{ item.flavor|urlencode }}">{{ item.name }} {{ item.weight }}g</a></h5>
                            <p><a href="{% url 'shop_by_itemname' itemname=item.fullname %}?flavor={{ item.flavor|urlencode }}">Flavor: {{ item.flavor }}</a></p>
                        </div>
                    {% endfor %}
                </div>
            </div>
            <img src="{% static '/supplement_store/images/right.svg' %}" alt="right1" width="50px" class="right-arrow" id="right-arrow-popular">
        </div>
    {% endif %}
    <div id="success-stories">
        <div id="success-stories-left">
            <h1>Vitality Vault Success Stories</h1>
            <h3>Amazing Before & After Results</h3>
            <p>Our success is your success. Hear from a few of the hundreds of low-carb and keto success stories our readers have sent us.</p>
            <div id="button-group">
                <a href="" id="btn-black">View All Stories</a>
                <a href="" id="btn-green">Submit your Story</a>
            </div>
        </div>
        <div id="success-stories-right">
            <img src="{% static '/supplement_store/images/success_story1.png' %}" alt="success_story1.png">
            <img src="{% static '/supplement_store/images/success_story2.png' %}" alt="success_story2.png">
            <img src="{% static '/supplement_store/images/success_story3.png' %}" alt="success_story3.png">
            <img src="{% static '/supplement_store/images/success_story4.png' %}" alt="success_story4.png">
        </div>
    </div>
{% endblock %}

{% block script %}
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const images = document.querySelectorAll(".slides");
            const rightBtn = document.querySelector("#right-arrow");
            const leftBtn = document.querySelector("#left-arrow");
            const dots = document.querySelectorAll(".dot");
            let index = 0;
            let intervalId;
            
            function startSlideShow() {
                intervalId = setInterval(() => {
                    if (index >= images.length - 1) {
                        index = 0;
                        images.forEach((image) => {
                            image.style.left = "0";
                        });
                    } else {
                        images[index].style.left = "-100%";
                        index += 1;
                    }
                    updateDotStyles();
                }, 3000);
            }
            startSlideShow();

            rightBtn.addEventListener("click", () => {
                clearInterval(intervalId);
                if (index >= images.length - 1) {
                    index = 0;
                    images.forEach((image) => {
                        image.style.left = "0";
                    });
                } else {
                    images[index].style.left = "-100%";
                    index += 1;
                }
                updateDotStyles();
                startSlideShow();
            });

            leftBtn.addEventListener("click", () => {
                clearInterval(intervalId);
                if (index <= 0) {
                    index = images.length - 1;
                    for (let i = 0; i < images.length - 1; i++) {
                        images[i].style.left = "-100%";
                    }
                } else {
                    index -= 1;
                    images[index].style.left = "0";
                }
                updateDotStyles();
                startSlideShow();
            });

            dots.forEach((dot, dotIndex) => {
                dot.addEventListener("click", () => {
                    clearInterval(intervalId);
                    index = dotIndex;

                    dots.forEach((eachDot) => {
                        eachDot.classList.remove("is_active");
                    });

                    images.forEach(image => {
                        if (index <= 0) {
                            dot.classList.add("is_active");
                            index = images.length - 1;
                            for (let i = 0; i < images.length - 1; i++) {
                                images[i].style.left = "-100%";
                            }
                        } else {
                            dot.classList.add("is_active");
                            index -= 1;
                            images[index].style.left = "0";
                        }
                        updateDotStyles();
                    });
                    startSlideShow();
                });
            });

            function updateDotStyles() {
                dots.forEach((dot, dotIndex) => {
                    if (dotIndex === index) {
                        dot.classList.add("is_active");
                    } else {
                        dot.classList.remove("is_active");
                    }
                });
            }
            updateDotStyles();

            const leftArrowNew = document.getElementById('left-arrow-new');
            const rightArrowNew = document.getElementById('right-arrow-new');
            const indexItemsNew = document.getElementById('new-items');

            if (indexItemsNew) {
                const itemWidth = 290;
                const visibleItems = 5;
                const totalItems = document.querySelectorAll('.new-item').length;
                const totalScrollWidth = totalItems * itemWidth;
                let scrollPosition = 0;
                
                const maxScrollPosition = totalScrollWidth - (visibleItems * itemWidth);

                if (leftArrowNew && rightArrowNew) {
                    leftArrowNew.addEventListener("click", () => {
                        if (scrollPosition > 0) {
                            scrollPosition -= itemWidth;
                            indexItemsNew.style.transform = `translateX(-${scrollPosition}px)`;
                        }
                    });

                    rightArrowNew.addEventListener("click", () => {
                        if (scrollPosition < maxScrollPosition) {
                            scrollPosition += itemWidth;
                            indexItemsNew.style.transform = `translateX(-${scrollPosition}px)`;
                        }
                    });
                }
            }

            const leftArrowSale = document.getElementById('left-arrow-sale');
            const rightArrowSale = document.getElementById('right-arrow-sale');
            const indexItemsSale = document.getElementById('sale-items');

            if (indexItemsSale) {
                const itemWidth = 290;
                const visibleItems = 5;
                const totalItems = document.querySelectorAll('.sale-item').length;
                const totalScrollWidth = totalItems * itemWidth;
                let scrollPosition = 0;
                
                const maxScrollPosition = totalScrollWidth - (visibleItems * itemWidth);

                if (leftArrowSale && rightArrowSale) {
                    leftArrowSale.addEventListener("click", () => {
                        if (scrollPosition > 0) {
                            scrollPosition -= itemWidth;
                            indexItemsSale.style.transform = `translateX(-${scrollPosition}px)`;
                        }
                    });

                    rightArrowSale.addEventListener("click", () => {
                        if (scrollPosition < maxScrollPosition) {
                            scrollPosition += itemWidth;
                            indexItemsSale.style.transform = `translateX(-${scrollPosition}px)`;
                        }
                    });
                }
            }

            const leftArrowPopular = document.getElementById('left-arrow-popular');
            const rightArrowPopular = document.getElementById('right-arrow-popular');
            const indexItemsPopular = document.getElementById('popular-items');

            if (indexItemsPopular) {
                const itemWidth = 290;
                const visibleItems = 5;
                const totalItems = document.querySelectorAll('.popular-item').length;
                const totalScrollWidth = totalItems * itemWidth;
                let scrollPosition = 0;
                
                const maxScrollPosition = totalScrollWidth - (visibleItems * itemWidth);

                if (leftArrowPopular && rightArrowPopular) {
                    leftArrowPopular.addEventListener("click", () => {
                        if (scrollPosition > 0) {
                            scrollPosition -= itemWidth;
                            indexItemsPopular.style.transform = `translateX(-${scrollPosition}px)`;
                        }
                    });

                    rightArrowPopular.addEventListener("click", () => {
                        if (scrollPosition < maxScrollPosition) {
                            scrollPosition += itemWidth;
                            indexItemsPopular.style.transform = `translateX(-${scrollPosition}px)`;
                        }
                    });
                }
            }
        });
    </script>
{% endblock %}